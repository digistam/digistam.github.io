<html>
    <meta name=”robots” content=”noindex,nofollow”/>
  <a href=index.html>Back to home</a>
<hr/>
<h1>Metasploit</h1>
<p><a target=_blank href=https://www.metasploit.com>The Metasploit Framework</a> is a penetration testing toolkit, exploit development platform and research tool that includes hundreds of working remote exploits for 
various platforms. It performs full automated exploitation of web servers by abusing known vulnerabilities and leveraging weak passwords via Telnet, SSH, HTTP and SNMP.</p>
    <p>An attacker may use the following features of Metasploit to perform a web server attack:</p>
    <p><ol>
        <ul>Closed-loop vulnerability validation</ul>
        <ul>Phishing simulations</ul>
        <ul>Social engineering</ul>
        <ul>Manual brute forcing</ul>
        <ul>Manual exploitation</ul>
        <ul>Evade-leading defensive solutions</ul>
    </ol></p>
    <p>Metasploit enables pen testers to perform the following:</p>
    <p><ol>
        <ul>Quickly complete pen-test assignments by automating repetitive tasks and leveraging multi-level attacks</ul>
        <ul>Assess the security of web applications, network and endpoint systems, as well as email users</ul>
        <ul>Tunnel any traffic through compromised targets to pivot deep into a network</ul>
        <ul>Customize the content and template of executive, audit and technical reports</ul>
    </ol></p>
    <h2>Metasploit Architecture</h2>
    <p>The Metasploit Framework is an open-source exploitation framework that provides security researchers and pen testers with a uniform model for the rapid development of exploits, payloads, encoders, no 
    operation (NOP) generators and reconnaissance tools. The framework reuses large chunks of code that a user would otherwise have to copy or re-implememnt on a per-exploit basis. The framwork is modular in 
    architecture and encourages the reuse of code across various projects. The framework can be broken down into a few different pieces, the lowest level of which is the framework core. The framework core is 
    responsible for implementing all the required interfaces that allow interaction with exploit modules, sessions and plugins. It supports vulnerability research, exploit development and the creation of 
    custom security tools.</p>

    <h2>Metasploit Modules</h2>
    <h2>Metasploit Exploit Module</h2>
    <p>Basic module in Metasploit used to encapsulate a single exploit, using which users target many platforms. This module has simplified meta-information fields. Using the Mixins feature, users can also 
    dynamically modify exploit behavior, perform brute-force attack and attempts passive exploits.</p>
    <p><ol>
        <ul>Configure an active exploit</ul>
        <ul>Verify the exploit options</ul>
        <ul>Select a target</ul>
        <ul>Select a payload</ul>
        <ul>Launch the exploit</ul>
    </ol></p>
    <h2>Metasploit Payload Module</h2>
    <p>An exploit carries a payload in its backpack when it breaks into a system and then leaves the backpack there. The following three types of payload modules are provided by the Metasploit Framework:</p>
    <p><ol>
        <ul>Singles -> self contained and completely standalone</ul>
        <ul>Stagers -> sets up a network connection between the attacker and victim</ul>
        <ul>Stages -> downloaded by stager modules</ul>
    </ol></p>
    <p>A Metasploit payload module can upload and download files from the system, take screenshots and collect password hashes. It can even take over the screen, mouse and keyboard to control a computer 
    remotely. The payload Module establishes a communication channel between the Metasploit framework and victim host. It combines arbitrary code that is executed as the result of an exploit succeeding. 
    To generate payloads, a payload is first selected using the command <i>use windows/shell_reverse_tcp</i></p>

    <h2>Metasploit Auxiliary Module</h2>
    <p>Auxiliary modules can be used to perform arbitrary, one-off actions such as port scanning, DoS and even fuzzing. It includes tools and modules that assess the security of the target as well as 
    auxiliary modules such as scanners, DoS modules and fuzzers. Use <i>show auxiliary</i> to list all the available auxiliary modules in Metasploit. All modules in Metasploit other than the ones used to 
    exploit are auxiliary modules. Metasploit uses auxiliary modules as an extension for various purposes other than exploitation. These modules are stored in in the modules/auxiliary/ directory of the 
    framework's main directory. The <i>run</i> command or the <i>exploit</i> command can be used to run an auxiliary module.</p>

    <h2>Metasploit NOPS module</h2>
    <p>NOPS generate no-operation instructions used for blocking out buffers.</p>

    <h1>Reconnaissance with Metasploit</h1>
    <p>One of the first steps in penetration testing is reconnaissance. Reconnaissance is the process of gathering information to obtain a better understanding 
        of a network. It enables you to create list of target IP addresses and devise a plan of attack. Once you have a list of IP addresses, you can run a 
        discovery scan to learn more about those hosts. A discovery scan identifies the operating systems that are running on a network, maps those systems to 
        IP addresses, and enumerates the open ports and services on those systems.<br/>
        A discovery scan is the internal Metasploit scanner. It uses Nmap to perform basic TCP port scanning and runs additional scanner modules to gather 
        more information about the target hosts. By default, the discovery scan includes a UDP scan, which sends UDP probes to the most commonly known UDP ports, 
        such as NETBIOS, DHCP, DNS, and SNMP. The discovery scan tests approximately 250 ports that are typically exposed for external services and are more 
        commonly tested during a penetration test.<br/>
        During a discovery scan, Metasploit Pro automatically adds the host data to the project. You can review the host data to obtain a better understanding 
        of the topology of the network and to determine the best way to exploit each target. Oftentimes, the network topology provides insight into the types 
        of applications and devices the target has in place. The more information that you can gather about a target, the more it will help you fine-tune a 
        test for it.</p>
    <h2>How a Discovery Scan Works</h2>
    <p>A discovery scan can be divided into four distinct phases:</p>
    <p><ol>
        <ul>1. Ping scan</ul>
        <ul>2. Port scan</ul>
        <ul>3. OS and version detection</ul>
        <ul>4. Data import</ul>
    </ol></p>
    <h2>1. Ping scan</h2>
    <p>Also in Metasploit, ping scans and ping sweeps are done with nmap. In new versions of nmap the ping sweep uses the -sn parameter, but in Metasploit
    this will not work well at the moment. In Metasploit, use the -sP parameter to do a ping sweep. You can <b>test</b> the command using plain nmap command and 
    you can store the hosts which respond to the ping with <b>db_nmap command</b>.</p>
    <p>Remember:</p>
    <p><ol>
        <ul>Metasploit also uses <b>nmap</b> for discover (ping sweep)</ul>
        <ul>The -sP parameter is used for this</ul>
        <ul>You can test with <b>nmap</b> command</ul>
        <ul>You can add responding hosts with <b>db_nmap</b> command</ul>
    </ol></p> 
    <h2>2. Port scann</h2>
    <p>During the second phase, port scanning, Metasploit runs Nmap to identify the ports that are open and the services are available on those ports. 
        Nmap sends probes to various ports and classifies the responses to determine the current state of the port. The scan covers a wide variety of commonly 
        exposed ports, such as HTTP, telnet, SSH, and FTP. The discovery scan uses the default Nmap settings, but you can add custom Nmap options to customize 
        the Nmap scan. For example, the discovery scan runs a TCP SYN scan by default. If you want to run a TCP Connect Scan instead of a TCP SYN Scan, 
        you can supply the -sT option. Any options that you specify override the default Nmap settings that the discovery scan uses.</p>
    <p>There is a nice trick to add all hosts to a temporary file, which nmap can use:</p>
    <p><ol>
        <ul>hosts -R</ul>
        <ul>copy the temporary file location and use it in the nmap command with the -iL parameter</ul>
        <ul>nmap -sS -iL /tmp/msf-db-rhosts-20241123-2694-922msk</ul>
        <ul>nmap will do SYN scan on all hosts that previously responded to the ping scan (it can take a while to complete!)</ul>
        <ul>db_nmap -sS iL /tmp/.. will add the responding ports to the services in Metasploit</ul>
    </ol>
    <p>Metasploit has also it's own methods for port scans:</p>
    <p><ol>
        <ul>search portscan type:aux</ul>
    <ul>0  auxiliary/scanner/portscan/ftpbounce              .                normal  No     FTP Bounce Port Scanner</ul>
   <ul>1  auxiliary/scanner/natpmp/natpmp_portscan          .                normal  No     NAT-PMP External Port Scanner</ul>
   <ul>2  auxiliary/scanner/sap/sap_router_portscanner      .                normal  No     SAPRouter Port Scanner</ul>
   <ul>3  auxiliary/scanner/portscan/xmas                   .                normal  No     TCP "XMas" Port Scanner</ul>
   <ul>4  auxiliary/scanner/portscan/ack                    .                normal  No     TCP ACK Firewall Scanner</ul>
   <ul>5  auxiliary/scanner/portscan/tcp                    .                normal  No     TCP Port Scanner</ul>
   <ul>6  auxiliary/scanner/portscan/syn                    .                normal  No     TCP SYN Port Scanner</ul>
   <ul>7  auxiliary/scanner/http/wordpress_pingback_access  .                normal  No     Wordpress Pingback Locator</ul>
    </ol></p>
    <p>
    <ol>
        <ul>use auxiliary/scanner/portscan/syn</ul>
        <ul>show options</ul>
    </ol></p>
<h2>3. OS and Version detection</h2>
    <p>After the discovery scan identifies the open ports, the third phase begins. Nmap sends a variety of probes to the open ports and detects the 
        service version numbers and operating system based on how the system responds to the probes. The operating system and version numbers provide 
        valuable information about the system and help you identify a possible vulnerability and eliminate false positives.</p>
<p>nmap -sV -O -iL /tmp/msf-db-rhosts-20241123-2694-922msk</p>
    <p>Results are available in <i>services</i></p>
    <h1>Further enumeration</h1>
    <h2>SMB</h2>
    <p>Then, based on our results, we will use the SMB scanner if port 445 is open. To scan an SMB, type <i>use auxiliary/scanner/smb/smb_version</p>
    <p>set RHOSTS [all hosts with port 445 open] > run</p>
    <p>Results will be added to <i>services</i></p>
    
          <h1>Commands</h1>
    <p><ol>
        <ul>search -h</ul>
        <ul>search rpc type:aux</ul>
        <ul>search ssh type:aux</ul>
        <ul>use ssh_enum type:aux</ul>
    </ol></p>
