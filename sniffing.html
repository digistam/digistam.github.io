<html>
    <meta name=”robots” content=”noindex,nofollow”/>
  <a href=index.html>Back to home</a>
<hr/>
<h1>Sniffing</h1>
<h2>Network Sniffing</h2>
    <p>Packet sniffing is the process of monitoring and capturing all data packets passing through a given network using a software application or hardware device.
    Sniffing is straightforward in hub-based networks. However, most networks today work on switches. Difference between hub and switch is that a hub transmits line 
    data to each port of the machine and has no line mapping, whereas a switch looks at the MAC address associated with each frame passing through it and sends the
    data to the required port. An attacker needs to manipulate the functionality of the switch to see all the traffic passing through it.</p> 
    <p>A packet sniffing program (sniffer) can capture data packets only from within a given subnet and cannot sniff packets from another network. Many enterprises' switches 
    are open and a packet sniffer placed on a network in <b>promiscuos mode</b> can therefore capture and analyze all the network traffic. Sniffing programs turn off the
    filter employed by Ethernet network interface cards (NICs) to prevent the host machine from seeing other stations' traffic. Thus, sniffing programs can monitor
    all traffic (passwords in cleartext, email traffic etc.).</p>

    <h2>How a sniffer works</h2>
    <p>Most common is networking through an Ethernet connection. A computer connected to a LAN has two addresses: MAC and IP. A MAC address uniquely identifies each node in a network 
    and is stored on the NIC. The Ethernet protocol uses the MAC address to transfer data. The <b>data link layer</b> of the OSI model uses an Ethernet header with the MAC address of the 
    destination machine instead of the IP address. The <b>network layer</b> is responsible for mapping IP network addresses to the MAC addresses as required by the data link protocol. It 
    initially looks for the MAC address of the destination machine in a table (<b>Address Resolution Protocol - ARP - cache). If there is no entry for the IP address, an ARP broadcast 
    of a requested packet goes out to all machines on the local sub-network. The machine with the particular address responds to the source machine with its MAC address. The source
    machine's ARP cache adds this MAC address to the table. The source machine, in all its communications with the destination machine, then uses this MAC address.</b></p>

    <p>Two basic types of Ethernet environments:</p>
    <p><ol>
        <ul>Shared Ethernet -> all other machines receive packets meant for one machine, passive and difficult to detect</ul>
        <ul>Switched Ethernet -> the host connects to a switch instead of a hub, the switch maintains a table that tracks each computer's MAC address, a switch does not broadcast to all computers</ul>
    </ol></p>
    <p>Although a switch is more secure than a hub, sniffing the network is possible using the following methods:</p>
    <p><ol>
        <ul>ARP Spoofing</ul>
        <ul>MAC Flooding</ul>
    </ol></p>
    <h2>ARP Spoofing</h2>
    <p>ARP is stateless. A machine can send an ARP reply even without asking for it; it can also accept such a reply. When a machine wants to sniff the traffic originating from another system, 
    it can ARP spoof the gateway of the network. The ARP cache of the target machine will have an incorrect entry for the gateway. Thus, all the traffic destined to pass through the gateway 
    will now pass through the machine that spoofed the gateway MAC address.</p>
    <h2>MAC Flooding</h2>
    <p>Switches maintain a translation table that maps various MAC addresses to physical ports on the switch. As a result, they can intelligently route packets from one host to another. 
    However, switches have a limited memory. MAC flooding makes use of this limitation to bombard switches with fake MAC addresses until the switches can no longer keep up. Once this happens to a switch, 
    it will enter fail-open mode, wherein it starts acting as a hub by broadcasting packets to all the ports on the switch. Macof is a utility that comes with the dsniff suit and helps the attacker to 
    perform MAC flooding.</p>
<p>Once a switch turns into a hub, it starts <b>broadcasting</b> all packets it receives to all the computers in the network. By default, promiscuous mode is turned off in network machines; therefore 
the NICs accept only those packets that are addressed to a user's machine and discard the packets sent to the other machines. A sniffer turns the NIC of a system to promiscuous mode so that it 
listens to all the data transmitted on its segment. A sniffer can constantly monitor all the network traffic to a computer through the NIC by decoding the information encapsulated in the data packets.
Attackers configure the NIC in their machines to run in <b>promiscuous mode</b> so that the card starts accepting all the packets. Thus, the attacker can view all the packets that are being transmitted 
in the network.</p>
<h2>Types of Sniffing</h2>
<p><ol>
    <ul>Passive sniffing</ul>
    <ul>Active sniffing</ul>
</ol></p>
    <h2>Passive sniffing</h2>
    <p>Passive sniffing involves sending no packets. It simply captures and monitors the packets flowing in the network. A packet sniffer alone is not preferred for an attack because it works only in a 
    common collision domain (sector of the network that's not bridged or switched -> connected through a hub). A network that uses hubs to connect systems uses passive sniffing.</p>
    <p>Attackers use the following passive sniffing methods to gain control over a target network:</p>
    <p><ol>
        <ul>Compromising physical security -> walk into the organization and plug the laptop into the network to capture sensitive information</ul>
        <ul>Using a Trojan horse -> most Trojans have in-built sniffing capability</ul>
    </ol></p>
    <p>A switch eliminates the risk of <b>passive sniffing</b>, but is still vulnerable for <b>active sniffing</b>!</p>

    <h2>Active sniffing</h2>
    <p>Active sniffing searches for traffic on a switched LAN by actively injecting traffic into it. Active sniffing refers to sniffing through a switch. In active sniffing the switched Ethernet does not transmit 
    information to all the systems connected through LAN as it does in a hub-based network. Active sniffing involves sending out multiple network probes to identify access points. It is easy to detect these sniffer programs and highly difficult to perform this type of sniffing. However, attackers can 
    actively inject ARP traffic into a LAN to sniff around and capture the traffic. Switches maintain their own ARP cache in <b>Content Addressable Memory (CAM)</b>. CAM is a special type of memory that maintains 
    a record of which host is connected to which port. Different active sniffing techniques:</p>

    <p><ol>
        <ul>MAC flooding</ul>
        <ul>DNS poisoning</ul>
        <ul>ARP poisoning</ul>
        <ul>DHCP attacks</ul>
        <ul>Switch port stealing</ul>
        <ul>Spoofing attack</ul>
    </ol></p>

    <h2>Procedure hacking the network using sniffers</h2>

    <p><b>Step 1</b>: an attacker who decides to hack a network first discovers the appropriate switch to access the network and connects a system or laptop to one of the ports on the switch</p>
    <p><b>Step 2</b>: an attacker who succeeds in connecting to the network tries to determine network information such as the topology of the network by using network discovery tools</p>
    <p><b>Step 3</b>: by analyzing the network topology, the attacker identifies the victim's machine to target his attacks</p>
    <p><b>Step 4</b>: an attacker who identifies a target machine uses ARP spoofing techniques to send fake (spoofed) Address Resolution Protocol (ARP) messages</p>
    <p><b>Step 5</b>: the previous step helps the attacker to divert all the traffic from the victim's computer to the attacker's computer (typical <b>Man-in-the-Middle (MITM)</b> type of attack)</p>
    <p><b>Step 6</b>: now, the attacker can see all the data packets sent and received by the victim, the attacker can now extract sensitive information from the packets, such as passwords, usernames, 
    credit card details, PINs etc.</p>

    <h2>Protocols vulnerable to sniffing</h2>
    <p><ol>
        <ul>Telnet and Rlogin</ul>
        <ul>HTTP</ul>
        <ul>SNMP</ul>
        <ul>SMTP</ul>
        <ul>NNTP</ul>
        <ul>POP</ul>
        <ul>FTP</ul>
        <ul>IMAP</ul>
    </ol></p>

    <h2>Sniffing in the Data Link Layer of the OSI Model</h2>
    <p>The data link layer is the second layer of the OSI model. In this layer, data packets are encoded and decoded into bits. Sniffers operate at the data link layer and can capture packets from this layer.
    Networking layers in the OSI model are designed to work independently of each other; thus if a sniffer sniffs data in the data link layer, the upper OSI layers will not be aware of the sniffing.</p>

    <h2>SPAN Port</h2>
    <p>CISCO has a feature named Switched Port Analyzer (SPAN), also known as "port mirroring", that monitors network traffic on one or more ports on the switch. A SPAN port is a port that is configured 
    to receive a copy of every packet that passes through a switch. The user can simultaneously monitor the traffic of multiple ports, such as the traffic on all the ports of a specific virtual local area 
    network (VLAN).</p>

    <h2>Wiretapping</h2>
    <p>Wiretapping or telephone tapping refers to monitoring by a third party with covert intentions. Typically the attacker uses a small amount of the electrical signals generated by the telephone wires to 
    tap the conversation. The following are ways to perform wiretapping:</p>

    <p><ol>
        <ul>Official tapping of telephone lines</ul>
        <ul>Unofficial tapping of telephone lines</ul>
        <ul>Recording of the conversation</ul>
        <ul>Direct line wiretap</ul>
        <ul>Radio wiretap</ul>
    </ol></p>

    <h2>Types of wiretapping</h2>
    <p>There are two types of wiretapping that an attacker can use to monitor, record and even alter the data flow in the communication system:</p>
    <p><ol>
        <ul>Active Wiretapping -> MITM attack, allowing an attacker to monitor and record the traffic or data flow in a communication system</ul>
        <ul>Passive Wiretapping -> snooping or eavesdropping, allowing an attacker to monitor and record traffic</ul>
    </ol></p>
    <p>Wiretapping without a warrant or the consent of the people conducting the conversation is a criminal offense in most countries</p>

    <h2>Lawful Interception</h2>
    <p>Legally intercepting data communication between two endpoints for surveillance on traditional 
    telecommunications, VoiP, data and multiservice networks. LI obtains data from a communication network
    for analysis or evidence. Law enforcement agencies (LEA) legally sanctions network operators or 
    service providers to get access to private network data for monitoring private communications like 
    telephone calls and email messages.</p>

    <h1>Sniffing Techniques</h1>
    <h2>MAC Attacks</h2>
    <p>Attackers use techniques to steal and manipulate sensitive data, in order to gain control 
    over a target network by reading captured data packets and then using that information to break 
    into the network. </p>
    <p>Attackers use MAC attacks or MAC flooding to force a switch to act as a hub.</p>
    <h2>MAC address</h2>
    <p>A MAC address uniquely identifies each node of a network (Layer 2). A MAC address comprises
    48 bits, split into two sections of 24 bits. The first section contains the ID number of the 
    manufacturer (organizationally unique identifier - OUI) and the next six digits (24 bits) indicate 
    the adapter's serial number. </p>
    <h2>CAM table</h2>
    <p>A CAM table is a dynamic table of fixed size. It stores information such as MAC addresses available 
    on physical ports along with VLAN parameters associated. When a machine sends data to another machine in a 
    network, the data passes through the switch. The switch searches for the destination MAC address (in 
    Ethernet frame) in its CAM table, and one the MAC address is found, it forwards data to the machine 
    through the port with which the MAC address is bound. A CAM table refers to the dynamic form of content 
    and works with an Ethernet switch. The Ethernet switch maintains connections between ports and the CAM 
    table keeps track of MAC address locations on the switch. But the table is limited in size. 
    If the CAM table is flooded with more MAC addresses than it can hold, the switch will turn into
    a hub. The CAM table does this intentionally to ensure the delivery of data to the intended host.</p>

    <h2>How does it work</h2>
    <p>Three machines:</p>
    <p><ol>
        <ul>Machine A with MAC address A</ul>
        <ul>Machine B with MAC address B</ul>
        <ul>Machine C with MAC address C</ul>
    </ol></p>
    <p>Machine A wants to interact with Machine B</p>
    <p>Machine A broadcasts an ARP request to the switch, containing:</p>
    <p><ol>
        <ul>IP address of Machine B</ul>
        <ul>IP address of Machine A</ul>
        <ul>MAC address of Machine A</ul>
    </ol></p>
    <p>The switch broadcasts the ARP request to all hosts in the network and waits for the reply</p>
    <p>Machine B recognizes it's IP address and sends back an ARP reply along with its MAC address</p>
    <p>The CAM table in the switch stores the MAC address along with the port on which Machine B is connected</p>
    <p>The connection is now successfully established and Machine A forwards the traffic to Machine B</p>
    <p>Machine C did receive the broadcast, but didn't respond because it didn't recognize the IP address</p>
    <p>Machine C is unable to see the traffic flowing between Machine A and Machine B</p>

    <h2>What happens if a CAM table is full </h2>
    <p>When a CAM table is full, the switch broadcasts all incoming traffic to all ports, 
    similar to a hub. The MAC flooding attack also fills the CAM table of adjacent switches.</p>

    <h2>MAC Flooding</h2>
    <p>In a MAC flooding attack the attacker sends numerous fake MAC addresses to the switch.
    When the CAM table is full, any further requests may force the switch to enter fail-open mode.
    The attacker then changes the machine's NIC to promiscuous mode to enable the machine to 
    accept all the traffic entering it.</p>

    <h2>MAC flooding with macof</h2>
    <p><a target=_blank href=https://medium.com/@S3Curiosity/unleash-macof-an-essential-ethical-hacking-tool-for-network-security-a12445bc0501>macof</a>
    is a Unix/Linux tool that is part of the <a target=_blank href=https://nl.wikipedia.org/wiki/Dsniff>dsniff</a> collection. 
    It floods the local network with random MAC and IP addresses, causing some switches to fail and open in 
    repeating mode, thereby facilitating sniffing. This tool floods the switch's CAM tables (131.000 per minute) 
    by sending forged MAC entries. When the MAC table fills up and the switch converts to hub-like 
    operation, an attacker can monitor the data being broadcast.</p>

    <h2>Switch port stealing</h2>
    <p>This technique uses MAC flooding to sniff the packets. The attacker floods the switch with 
    forged gratuitous ARP packets with the target MAC address as the source and his own MAC 
    address as the destination. A race condition of the attacker's flooded packets and target host
    packets will occur and thus, the switch has to change its MAC address to bind constantly 
    between two different ports. In this case, if the attacker is fast enough, he will be able
    to direct the packets intended for the target host towards his switch port. Here, the attacker
    manages to steal the target host switch port and sends an ARP request to the switch port to
    discover the target host's IP address. When the attacker gets an ARP reply, this indicates 
    that the target host's switch port binding has been restored and the attacker can now sniff
    the packets sent towards the targeted host.</p>

     <h2>How does it work</h2>
    <p>Three machines:</p>
    <p><ol>
        <ul>Machine A with MAC address A</ul>
        <ul>Machine B with MAC address B</ul>
        <ul>Machine C with MAC address C</ul>
    </ol></p>
    <p>Machine C is the attacker</p>
    <p>Machine C spoofs both the IP address and the MAC address of Machine B</p>
    <p>Machine C runs a sniffer in promiscuous mode</p>
    <p>Machine A wants to communicate with Machine B and sends an ARP request to the switch, containing:</p>
    <p><ol>
        <ul>IP address of Machine B</ul>
        <ul>IP address of Machine A</ul>
        <ul>MAC address of Machine A</ul>
    </ol></p>
    <p>The switch broadcasts the ARP request to all machines in the network</p?
    <p>Before Machine B can respond to the ARP request, Machine C responds to the ARP request 
        by sending an ARP reply containing the spoofed MAC and IP addresses</p>
    <p>Machine C can achieve this by launching an attack such as DoS on Machine B, which slows 
        down its response</p>
    <p>Now the ARP cache in the switch records the spoofed MAC and IP addresses</p>
    <p>The spoofed MAC address of Machine B and the port connect to Machine C and update 
        the switch's CAM table</p>
    <p>Now, a connection is established between Machine A and Machine C</p>
    <p>The system will forward all the packets directed towards Machine B to Machine C (the attacker)</p>
