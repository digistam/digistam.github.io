<html>
<!doctype html>
<html>
<head>
<meta charset="UTF-8"/>
<title>ONTOLOGY VALIDATOR</title>
<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<link href="css/custom.css" rel="stylesheet" />

<style type="text/css">
#wrapper {
    width: 900px;
    border: 0px;
    overflow: hidden; /* add this to contain floated children */
}
#lineNa {
    width: 100px;
    float:left; /* add this */
    border: 0px;
	font-size: 40px;
}
#lineNo {
    border: 0px;
    float: left; /* add this */
	font-size: 40px;
}
.ad-left {
  float: left;
}

.ad-right {
  float: left;
  margin-left: 10px;
  font-size: 18px;
}

.entire-thing {
  width: 600px;
}
</style>

</head>
<body style="margin:30px;padding:20px">
<div class="wrapper">
  <header>
    <!-- <div class="container"> -->
    <h1><b>ONTOLOGY VALIDATOR</b></h1>
     <!-- <div id="wrapper">
    <div id="lineNa">Item: </div>
    <div id="lineNo"></div>
	</div> -->
    <!-- </div> -->
<br/><br/>
  </header>
 
 <div class="entire-thing">
<div class="ad-left">
<div class="container">

  <textarea rows="20" cols="50" id="values" class="form-control" onkeyup="getLineNumber(this, document.getElementById('lineNo'));" onmouseup="this.onkeyup();"></textarea>
  <br/>
      <div id="wrapper">
    <div id="lineNa">Item: </div>
    <div id="lineNo"></div>
	</div>
	<hr>
  <!-- <div id="warning"> --></div>
  <a id="saveToFile" class="btn btn-primary">create ontology file</a>
  <br/><br/>
  <div class="container">
    Copyright Tardis Research &copy; 2019<br/>
	Author: ^MS
  </div>
</div>
</div>
<div class="ad-right">
  <div id="warning"></div>
</div>
<div class="clear"></div>
</div>

  <!-- <div class="container">

  <textarea rows="40" cols="50" id="values" class="form-control" onkeyup="getLineNumber(this, document.getElementById('lineNo'));" onmouseup="this.onkeyup();"></textarea>
  <br/><br/>
  <div id="warning"></div>
  <a id="saveToFile" class="btn btn-primary">create ontology file</a>
  <br/><br/>
</div> -->
</div>
<!-- <footer>
  <div class="container">
    Copyright Tardis Research &copy; 2019<br/>
	Author: ^MS
  </div>
</footer> -->
<script src="http://code.jquery.com/jquery.js"></script>

<script>
$(function() {
  $('#saveToFile').click(function(e) {
	var tab = RegExp("\\t", "g"); // define tab
	
	// Error checking
	var stringArray = document.getElementById('values').value.split('\n');
	//stringArray.shift(); // remove first element 
	// check for stand alone wildcards 
	var lone_wildcard_1 = /\s\*/;
	var lone_wildcard_2 = /\*\s/;
	$('#warning').empty();
	for(var i = 0; i < stringArray.length; i++) {
	    var subStr = stringArray[i].replace(tab,',').replace(/,{2,}/g, ',');
		if (lone_wildcard_1.test(subStr) === true) {
			$('#warning').append('<p style="color:red"><b>Item ' + (i +1) + ': ' + subStr.match(/[^0-9\.,]{2,200}\s\*/g) + ' has a stand alone wildcard</b></p>');
			}
		else if (lone_wildcard_2.test(subStr) === true) {
			$('#warning').append('<p style="color:red"><b>Item ' + (i +1) + ': ' + subStr.match(/\*\s[^0-9\.,]{2,200}/g) + ' has a stand alone wildcard</b></p>');
			}
	}

	//
	
    var data = document.getElementById('values');
	var data = data.value.replace(/^.*\n/,'a,b,c,d,e\n'); // replace first line
	var data = data.replace(tab,','); // replace tab by comma for csv output
	var data = data.replace(/,{2,}/g, ','); // replace multiple comma's by one comma 
	var data = data.replace(/\nPhenomenon,/g, '\n5000,'); // replace Ontology type by code 
	var data = data.replace(/\nEvent,/g,'\n4000,'); // replace Ontology type by code 
	var data = data.replace(/Country,/g,'1000'); // replace Ontology type by code 
	var data = data.replace(/City,/g,'1001,'); // replace Ontology type by code 
	var data = data.replace(/Location,/g,'1002,'); // replace Ontology type by code 
	var data = data.replace(/Person,/g,'2000,'); // replace Ontology type by code 
	var data = data.replace(/Organization,/g,'3000,'); // replace Ontology type by code
	
	var data = data.replace(/,All languages,/g, ',0,None,');
	var data = data.replace(/,Nederlands,/g, ',1,None,');
	var data = data.replace(/,Slang (street language),/g, ',2,None,');
	var data = data.replace(/,English,/g, ',3,None,');
	var data = data.replace(/,German,/g, ',4,None,');
	var data = data.replace(/,French,/g, ',5,None,');
	var data = data.replace(/,Italian,/g, ',6,None,');
	var data = data.replace(/,Arabic,/g, ',7,None,');
	var data = data.replace(/,Spanish,/g, ',8,None,');
	var data = data.replace(/,Hebrew,/g, ',9,None,');	
	var data = data.replace(/,Danish,/g, ',10,None,');
	
	var data = data.replace(/Topic.*framing,/g, '');
	var data = data.replace(/Tactic.*operandi,/g, '');
	var data = data.replace(/Social phenomenon,/g, '');
	var data = data.replace(/Social group,/g, '');
	var data = data.replace(/Service.*agency,/g, '');
	var data = data.replace(/Road,/g, '');
	var data = data.replace(/Religion.*orientation,/g, '');
	var data = data.replace(/Publication,/g, '');
	var data = data.replace(/Object,/g, '');
	var data = data.replace(/Location,/g, '');
	var data = data.replace(/Event,/g, '');
	var data = data.replace(/Context.*Weapons,/g, '');
	var data = data.replace(/Context.*Violence,/g, '');
	var data = data.replace(/Context.*unrest,/g, '');
	var data = data.replace(/Context.*Drugs,/g, '');
	var data = data.replace(/Context.*general\),/g, '');
	var data = data.replace(/Club,/g, '');
	var data = data.replace(/Activity,/g, '');

	var data = data.replace(/,\n/g,'\n'); // remove trailing comma
	var data = data.replace(/,$/g,''); // remove trailing comma from last line
	var data = data.replace(/(^,)|(,$)/g, "");

	var data = data.replace(/(.*?),(.*?),(.*?),(.*?),(.*)/g, '$1,$2,$3,"$4","$5"'); 
	// RegEx matching $1: type, $2: language, $3: dossier_id, $4: name, $5: synonyms
	
	var data = data.replace(/^.*\n/,'type,language,dossier_id,name,terms\n'); // clean first line
	
	if( $('#warning').is(':empty') && ($("#values").val()) && ($("#values").val()) && $("#values").val().indexOf("OntologyType") > -1) {
    var data = 'data:application/csv;charset=utf-8,' + encodeURIComponent(data);
	
    var el = e.currentTarget;
    el.href = data;
	
    el.target = '_blank';
    el.download = 'data.csv';
	}
  });
});
</script>
  <script>

    function getLineNumber(textarea, indicator) {

        indicator.innerHTML = textarea.value.substr(0, textarea.selectionStart).split("\n").length;
    }

</script>

</body>
</html>
</html>