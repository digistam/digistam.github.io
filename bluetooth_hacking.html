<html>
    <meta name=”robots” content=”noindex,nofollow”/>
  <a href=index.html>Back to home</a>
<hr/>
<h1>Bluetooth</h1>
<p>Bluetooth is a wireless technology that allows devices to share data over short distances. Bluetooth technology is vulnerable to various types of attacks. </p>
    <h2>Hands on</h2>
    <p><a target=_blank href=https://null-byte.wonderhowto.com/how-to/target-bluetooth-devices-with-bettercap-0194421/>Bettercap target BT</a></p>
    <h2>Bluetooth Stack</h2>
    <p>Bluetooth is a short-range wireless communication technology that replaces cables connecting portable or fixed devices while maintaining high levels of security. 
    It allows mobile phones, computers and other devices to exchange information. Two BT enabled devices connect through a pairing technique.</p>
    <p>The BT Stack has two ports: general purpose and embedded system</p>
    <h2>BT Modes</h2>
    <p><ol>
        <ul>Discoverable -> when discoverable, BT devices are visible to other BT enabled devices; the discoverable mode is necessary only while connecting to a device for the first time. Upon 
        saving the connection, the devices remember each other; therefore the discoverable mode is not necessary for lateral connection establishment</ul>
        <ul>Limited discoverable -> in limited discoverable mode, the BT devices are discoverable only for a limited period, for a specific event or during temporary conditions; However, there is no 
        Host Controller Interface (HCI) command to set a device directly in the limited discoverable mode. A user has to do this indirectly. When a device is set to the limited discoverable mode, it 
        filters out non-matched IACs and reveals itself only to those that matched</ul>
        <ul>Non-discoverable -> setting to non-discoverable prevents that device from appearing on the list during a BT enabled device search process; However, it remains visible to users and devices 
        that were previously paired with or knows its MAC address</ul>
    </ol></p>
    <h2>Pairing Modes</h2>
    <p><ol>
        <ul>Non-pairable mode -> a BT device rejects pairing requests</ul>
        <ul>Pairable mode -> a BT device can accept pairing requests and establish a connection with a device that requested pairing</ul>
    </ol></p>
<h1>Bluetooth Hacking</h1>
<p>BT hacking refers to the exploitation of BT Stack implementation vulnerabilities to compromise sensitive data in BT enabled devices and networks.</p>
<p>BT enabled devices connect and communicate wirelessly through ad-hoc networks known as <b>piconets</b>. Attackers can gain information by hacking the target BT enabled device from another BT 
enabled device.</p>
<h2>BT attacks</h2>
<p><ol>
    <ul><b>Bluesmacking</b> -> send an oversized packet to a victim's device, causing a buffer overflow (similar to ICMP ping-of-death)</ul>
    <ul><b>Bluejacking</b> -> using BT to send messages to users without the recipient's consent, similar to email spamming</ul>
    <ul><b>Bluesnarfing</b> -> method of gaining access to sensitive data in a BT enabled device; an attacker within the range of a target can use specialized software to obtain the data 
    stored on the victim's device; to perform Bluesnarfing, an attacker exploits a vulnerability in the Object Exchange (OBEX) protocol that BT uses to exchange information. The attacker connects with 
    the target and performs a GET operation for files with correctly guessed or known names, such as /pb.vcf for the device's phonebook or /cal.vcs for the device's calendar file</ul>
    <ul><b>Bluesniff</b> -> POC code for a BT wardriving utility, for finding hidden and discoverable BT devices, operating on Linux</ul>
    <ul><b>Bluebugging</b> -> attack in which an attacker gains remote access to a target BT enabled device without the victim's awareness; in this attack, an attacker sniffs sensitive information 
    and might perform malicious activities such as intercepting phone calls and messages and forwarding calls and text messages</ul>
    <ul><b>BluePrinting</b> -> footprinting technique performed by an attacker to determine the make and model of a target BT enabled device. Attackers collect this information to create infographics of the 
    model, manufacturer etc. and analyze them to determine whether the device has exploitable vulnerabilities</ul>
    <ul><b>BtleJacking</b> -> a BtleJacking attack is detrimental to BT low energy (BLE) devices. The attacker can sniff, jam, and take control of the data tranmission between BLE devices by performing 
    an MITM attack. Following a succesful attempt, the attacker can also bypass security mechanisms and listen to the information being shared. To implement this attack, the attacker must use affordable 
    firmware-embedded equipment and minor software coding</ul>
    <ul><b>KNOB attack</b> -> a Key Negotiation of Bluetooth (KNOB) attack enables an attacker to breach Bluetooth security mechanisms and perform an MITM attack on paired devices without being traced; 
    The attacker leverages a vulnerability in the BT wireless standard and eavesdrops on all the data being shared in the network, such as keystrokes, chats and documents. A KNOB attack is especially 
    detrimental to two BT enabled devices sharing encrypted keys. The attack is launched on short-distance communication protocols of BT negotiating the encrypted keys required to be shared between nodes 
    to establish a connection</ul>
    <ul><b>MAC spoofing attack</b> -> a MAC spoofing attack is a passive attack in which attackers spoof the MAC address of a target BT enabled device to intercept or manipulate the data sent to the target device</ul>
    <ul><b>MITM / impersonation attack</b> -> attackers manipulate the data transmitted between devices communicating via a BT connection (piconet). During this attack, the devices intended to pair with each other
    unknowingly pair with the attacker's device, thereby allowing the attacker to intercept and manipulate the data transmitted in the piconet</ul>
</ol></p>
<h1>Bluetooth Threats</h1>
<p><ol>
    <ul>Leakage of calendars and address books -> stealing personal information</ul>
    <ul>Bugging devices -> instruct a smartphone to make a call to other phones without any user interaction; even record a user's conversation</ul>
    <ul>Sending SMS messages -> bomb threats etc.</ul>
    <ul>Causing financial loss -> MMS messages to international phones</ul>
    <ul>Remote control -> remotely control a smartphone to make phone calls or connect to the internet</ul>
    <ul>Social engineering -> trick BT users into lowering security or disabling authentication for BT connections to pair with them and steal their information</ul>
    <ul>Malicious code -> smartphone worms can exploit a BT connection to replicate and spread</ul>
    <ul>Protocol vulnerabilities -> exploit BT pairings and communication protocols to steal data, make calls, send messages, launch DoS attacks on a device, spy on phones etc.</ul>
</ol></p>
    <h1>BT Reconnaissance using BlueZ</h1>
    <p>BlueZ is a similar built-in protocol stack for Linux - based systems that has several default tools for BT reconnaissance. Because they are available in every Linux system, the attacker 
    can utilize them with modest commanding skills. Attackers use BlueZ tools to discover BT devices through the following steps:</p>
    <p><ol>
        <ul>Configure the BT device using <b>hciconfig</b> -> the BT device and its MAC address named hci0 will be detected in Linux; command: <b><i>hciconfig hci0 up</i></b></ul>
        <ul>Scan for pairable BT devices using <b>hcitool</b> -> command: <b><i>hcitool scan</i></b></ul>
        <ul>After finding pairable devices, use the following command to display further information about the discovered devices: <b><i>hcitool inq</i></b></ul>
        <ul>Use the Service Discovery Protocol (SDP) tool to scan services -> command: <b><i>sdptool browse [MAC Address]</i></b></ul>
        <ul>Ping all the available devices to check if they are reachable using L2ping -> command: <b><i>l2ping [MAC Address]</i></b></ul>
        <ul>Attackers can gather information such as MAC addresses and services offered by devices, with this information they can launch further attacks</ul>
    </ol></p>

    <h1>Btlejacking using BtleJack</h1>
    <p>Btlejack is an open-source software that enables an attacker to perform a Btlejacking attack using a hardware tool such as micro:bit (https://microbit.org). It helps attackers sniff, jam and hijack
    BT connections. Upon gaining access to a connection, an attacker can hijack, read and export sensitive information shared between the connected devices.</p>
    <p><ol>
        <ul>Select target devices using the following command: <b><i>btlejack -d /dev/ttyACM0 -d /dev/ttyACM2 -s</i></b></ul>
        <ul>With the Btlejack tool, take a position within a radius of 5 m from the target devices</ul>
        <ul>Capture already established (live) as well as new BT low enery connections using the following commands:</ul>
        <ul>Sniffing an existing connection -> <b><i>btlejack -s</i></b></ul>
        <ul>Sniffing for new connections -> <b><i>btlejack -c any</i></b></ul>
        <ul>Once the connection is captured, perform a jamming operation using the following command: <b><i>btlejack -f 0x129f3244 -j</i></b></ul>
        <ul>Start hijacking the connection using the following command: <b><i>btlejack -f 0x9c68fd30 -t -m 0x1fffffffff</i></b></ul>
        <ul>The captured data can be converted into the pcap format using the following command: <b><i>btlejack -f 0xac56bc12 -x nordic -o capture.nordic.pcap</i></b></ul>
    </ol></p>

    <h1>Crackling BLE Encryption using crackle</h1>
    <p>The BT Low Energy (BLE) technology is implemented on modern wireless devices and gadgets such as sensors, mobile phones, cars, beacons, fitness watches etc. The data exchange and pairing process in BLE 
    devices can occur in two phases. In the first phase, devices exchange details about their types and abilities to determine the best possible way to establish a connection. The second phase is a key phase that 
    involves key establishment and exchange. Attackers use tools such as <b>crackle</b> that mainly target the second phase to breach and gain access to the target device. </p>
<h2>Crackle</h2>
<p><a target=_blank href=https://github.com/mikeryan/crackle>Crackle</a> exploits a flaw in the BLE pairing process that allows an attacker to guess or very quickly brute force the temporary key (TK). With the TK 
and other data collected from the pairing process, the short-term key (STK) and later, the long-term key (LTK) can be collected. With the STK and LTK, all communication between master and slave devices can be 
decrypted.</p>
<h2>Crack TK mode</h2>
<p>This mode is operated during the pairing phase of BLE, where the tool attempts to brute-force the TK. For this purpose, the tool requires a PCAP file containing all the BLE pairing events. Run the following 
command to check whether all the pairing packets are present in the PCAP file using the -i argument:</p>
<p><b><i>crackle -i [file.pcap]</i></b></p>
<p>Crackle checks for active connections and then determines the vulnerable connections to breach.</p>
<p>The encrypted pcap data can be decrypted by adding the -o option using the following command:</p>
<p><b><i>crackle -i [file.pcap] -o [output.pcap]</i></b></p>
<h2>Decryption using LTK</h2>
<p>In this mode, to unlock the encrypted data, crackle requires an LTK value, which is a 128 hexadecimal number, and a PCAP file containing LL_ENC_REQ and LL_ENC_RSP packets. Run the following command with the 
-i and -1 options, which assist in verifying the data within the file:</p>
<p><b><i>crackle -i [file.pcap] -1 [LTK]</i></b></p>
<p>Run the following command to decrypt the packets and store them in a PCAP file using the -o option:</p>
<p><b><i>crackle -i [file.pcap] -o [out.pcap] -1 [LTK]</i></b></p>
