    <meta name=”robots” content=”noindex,nofollow”/>
  <a href=../index.html>Back to home</a>
<hr/>
<h1>Web Server Attack Countermeasures</h1>
<h2>Place Web Servers in separate secure server security segment on network</h2>
<p>An ideal web hosting network should be designed with three segments:</p>
<p><ol>
  <ul>Internet segment</ul>
  <ul>Secure server security segment (<b>DMZ</b>b)</ul>
  <ul>Internal network</ul>
</ol></p>
<p>The first step in securing web servers is to place them separately in the DMZ, which is isolated from the public network and from the internal webhosting network.
Placing web servers in a separate segment adds security barriers between the web servers and the internal network as well as between the web servers and the outside public network. This separation allows the 
administrator to place firewalls and apply access control based on security rules for the internal network as well as for internet traffic toward the DMZ. Such a webhosting network can prevent attacks 
on the web server by outside attackers or malicious insiders.</p>
<p>Network segmentation divides a network into different segments, each having its own hub or switch. It allows protection by enforcing firewalls and security rules depending on the level of security desired.
An attacker who compromises one segment of the network will not be able to compromise the security of other segments of the network.</p>

<h2>Protocols and accounts</h2>
<p><ol>
  <ul>Block all unnecessary ports, ICMP traffic and unnecessary protocols such as NetBIOS and SMB</ul>
  <ul>Harden the TCP/IP stack and consistently apply the latest software patches and updates to system software</ul>
    <ul>If insecure protocols such as Telnet, POP3, SMTP and FTP are used, then take appropriate measures to provide secure authentication and communication, for example, by using IPsec policies</ul>
    <ul>If remote access is needed, ensure that remote connections are secured properly by using tunneling and encryption protocols</ul>
    <ul>Disable Web Distributed Authoring and Versioning (WebDAV) if it is not used by the application, or keep it secure if it is required</ul>
    <ul>Use secure protocols such as Transport Layer Security (TLS)/SSL for communicating with the web server</ul>
    <ul>Ensure that unidentified FTP servers operate in an innocuous part of the directory tree that is different from the web server's tree</ul>
    <ul>Ensure that the HTTP service banner is properly configured to cover the details of the host device like OS version and type</ul>
    <ul>Isolate the supporting servers such as LDAP servers from the local subnet to filter out the traffic through a firewall before entering the local network</ul>
    <ul>Ensure that all the file transfer applications through the web server are done through FTPS for better data encryption and protection</ul>
</ol></p>
<p><ol>
    <ul>Remove all unused modules and application extensions</ul>
    <ul>Disable unused default user accounts created during the installation of an OS</ul>
    <ul>When creating a new web root directory, grant the appropriate (least possible) NTFS permissions to anonymous users of the IIS web server to access the web content</ul>
    <ul>Eliminate unnecessary database users and stored procedures and follow the principle of least privilege for the database application to defend against SQL query poisoning</ul>
    <ul>Use secure web permissions, NTFS permissions and .NET Framework access control mechanisms, including URL authorization</ul>
    <ul>Slow down brute-force and dictionary attacks with strong password policies and implement audits and alerts for login failures</ul>
    <ul>Run processes using least privileged accounts as well as least privileged services and user accounts</ul>
    <ul>Limit the administrator or root-level access to the minimum number of users and maintain a record of the same</ul>
    <ul>Maintain logs of all user activity in an encrypted form on the web server or in a separate machine on the intranet</ul>
    <ul>Disable all noninteractive accounts that should exist but do not require an interactive login</ul>
    <ul>Use secure VPN networks such as OpenVPN while accessing multi-server platforms or accessing data from cross-server network models, which helps use one account for multiple server access</ul>
    <ul>Enable the Separation of Duties (SoD) feature on the server config settings</ul>
    <ul>Force users to periodically change passwords for their accounts by creating a password expiry policy</ul>
    <ul>Enable the user account locking feature by setting a limit on the number of failed login attempts</ul>
    <ul>Implement 2FA or MFA as an additional layer of security for user accounts</ul>
</ol></p>
<h2>Files and Directories</h2>
<p><ol>
    <ul>Eliminate unnecessary files within .jar files</ul>
    <ul>Eliminate sensitive configuration information within the byte code</ul>
    <ul>Avoid mapping virtual directories between two different servers or over a network</ul>
    <ul>Monitor and check all network services logs, website access logs, database server logs (e.g., Microsoft SQL Server, MySQL, and Oracle), and OS logs frequently</ul>
    <ul>Disable the serving of directory listings</ul>
    <ul>Eliminate non-web files such as archive files, backup files, text files, and header/include files</ul>
    <ul>Disable the serving of certain file types by creating a resource map</ul>
    <ul>Ensure that web applications or website files and scripts are stored in a partition or drive separate from that of the OS, logs, and any other system files</ul>
    <ul>Run the web server within a sandbox directory for preventing access to system files</ul>
    <ul>Avoid all non-web file types from being referenced in a URL</ul>
    <ul>Run the web server processes with the least required privileges and give access only to the necessary directories</ul>
    <ul>Exclude meta characters while processing user inputs to ensure proper filtering of inputs</ul>
    <ul>Employ file integrity checkers to verify web content and intrusion detection</ul>
</ol></p>

<h1>Detecting Web Server Hacking Attempts</h1>

<p>An attacker who gains access to a web server by compromising security through known vulnerabilities present in the web server may attempt to plant backdoors (scripts). These backdoors allow the 
attacker to gain access, launch phishing attacks or send spam emails. The victim remains unaware of the web server attack until the server is blacklisted on spam mails or until the attacker 
redirects the visitor of a target site hosted on the web server to some other site. Thus, a web server attack is difficult to detect unless such malicious events occur. By the time these events occur, 
it may be too late to react because the attacker would have already succeeded. A mechanism to detect a web server hacking attempt in its early stages is required to prevent harm to the web server.</p>
<p>When an attacker installs a backdoor on a web server, the size of files infected with the backdoor automatically increases. A <b>website change detection system (WDS)</b> is a script that runs on the server 
to detect changes made to any executable file or the presence of any new file on the web server, such as HTML , JavaScript (JS), PHP, Active Server Pages (ASP), Perl and Python files. It works by 
periodically comparing the hash values of the files on the server with their respective master hash values to detect any changes to the codebase. If it detects any change on the server, it alerts the 
user to take necessary action. Thus, WDS helps in detecting web server hacking attempts in the early stages of an attack. For example, <a target=_blank href=https://directorymonitor.com/>DirectoryMonitor</a> is
an automated tool that goes through entire web folders, detects any changes made to the codebase and alerts the user through an email.</p>

<h1>Defend against web server attacks</h1>
<h2>Ports</h2>
<p>Monitor all ports on the web server regularly to prevent unnecessary traffic toward the target web server. If traffic is not monitored, the target web server will be vulnerable to malware attacks. 
Do not allow public access to port 80 for HTTP or to port 443 for HTTPS; traffic to these ports should be limited. If port 80 is kept open, the server will be vulnerable to DoS attacks. Intranet traffic 
should either be encrypted or restricted to secure the web server. </p>
<p>Attackers attempt to hide their identity by spoofing the IP address of a legitimate user. By processing the security log file, either using the 'deny this IP address' rule in the firewall ruleset file or 
by creating a 'routed blackhole' command, the target system can defend against web server attacks.</p>

<h2>Server Certificates</h2>
<p>Server certificates guarantee security and are signed by a trusted authority. However, an attacker may compromise certified servers using forged certificates to intercept secure communications by 
performing MITM attacks. There are various techniques to avoid such MITM attacks:</p>
<p><ol>
    <ul>Use the direct validation of certificates</ul>
    <ul>Use a novel protocol that does not depend on third parties for certificate validation</ul>
    <ul>Allow domains to directly and securely examine their certificates by using previously established user authentication credentials</ul>
    <ul>Use a robust cryptographic construction that enhances server identity validation and resolves the limitations of third-party solutions</ul>
    <ul>Ensure that the certificate data ranges are valid and that certificates are used for their intended purpose</ul>
    <ul>Ensure that the certificate has not been revoked and that the certificate's public key is valid all the way to a trusted root authority</ul>
</ol></p>
<h2>Machine.config</h2>
<p>The machine.config file provides a mechanism of securing information by changing machine-level settings. It affects all other applications. The machine.config file includes machine settings for the 
.Net framework, which affect the security. The following can be performed with the machine.config file:</p>
<p><ol>
    <ul>Ensure that protected resources are mapped to HttpForbiddenHandler and that unused HttpModules are removed</ul>
    <ul>Ensure that tracking is disabled <trace enable="false"/> and debug compiles are turned off</ul>
    <ul>Verify that ASP.NET errors are not rverted to the client</ul>
    <ul>Verify session state settings</ul>
</ol></p>
<h2>Code Access Security</h2>
<p><ol>
    <ul>Implement secure coding practices to avoid source-code disclosure and input validation attacks</ul>
    <ul>Restrict code access security policy settings to ensure that there are no permissions to execute code downloaded from the internet / intranet</ul>
    <ul>Configure IIS to reject URLs with "../" to prevent path traversal, lockdown system commands and utilities with restrictive access control lists (ACLs), and install new patches and updates</ul>
    <ul>If targets do not implement code access security in their web servers, then there is a possibility of execution of malicious code</ul>
</ol></p>
<h2>Measures to defend against web server attacks</h2>
<p><ol>
    <ul>Apply restricted ACLs and block remote registry administration</ul>
    <ul>Secure the SAM (stand-alone servers only)</ul>
    <ul>Ensure that security-related settings are configured appropriately and that access to the metabase file is restricted with hardened NTFS permissions.</ul>
    <ul>Remove unnecessary Internet Server Application Programming Interface (ISAPI) filters from the web server.</ul>
    <ul>Remove all unnecessary file shares, including the default administration shares, if they are not required.</ul>
    <ul>Secure the shares with restricted NTFS permissions</ul>
    <ul>Relocate sites and virtual directories to non-system partitions and use IIS web permissions to restrict access.</ul>
    <ul>Remove all unnecessary IIS script mappings for optional file extensions to avoid exploitation of any bugs in the ISAPI extensions that handle these types of files.</ul>
    <ul>Enable a minimum level of auditing on the web server and use NTFS permissions to protect log files.</ul>
    <ul>Use a dedicated machine as a web server</ul>
        <ul>Create URL mappings to internal servers cautiously</ul>
        <ul>Do not install the IIS server on a domain controller</ul>
            <ul>Use server-side session ID tracking and match connections with timestamps, IP addresses, etc.</ul>
    <ul>If a database server such as Microsoft SQL Server is to be used as a backend database, install it on a separate server.</ul>
    <ul>Use security tools provided with web server software and scanners that automate and simplify the process of securing a web server.</ul>
    <ul>Physically protect the web server machine in a secure machine room</ul>
        <ul>Do not connect an IIS Server to the Internet until it is fully hardened</ul>
            <ul>Do not allow anyone to locally log in to the machine except the administrator</ul>
    <ul>Configure a separate anonymous user account for each application if multiple web applications are hosted.</ul>
    <ul>Limit the server functionality to support only the web technologies to be used</ul>
        <ul>Screen and filter incoming traffic requests</ul>
            <ul>Store website files and scripts on a separate partition or drive</ul>
                <ul>Use an effective anti-bot mitigation service such as DataDome to detect botnets in real time</ul>
</ol></p>

<h2>Defend against HTTP Response-Splitting and Web Cache Poisoning</h2>
<p>While setting cookies, remove carriage returns (CRs) and linefeeds (LFs) before inserting data into an HTTP response header. Best practice is to use third-party products to test
for the existence of security holes and defend against CRLF injection. Ensure that data application engines are up to date.</p>
<p>The UDP source port randomization technique defends servers against blind response forgery. Limit the number of simultaneous recursive queries and increase the TTL of legitimate records.</p>
<p><ol>
    <ul>Server Admin -> use the latest web server software; regularly update / patch OS and web server; run web vulnerability scanner</ul>
    <ul>Application Developers -> restrict web application's access to unique IPs; disallow CR (%0d or \r) and LF (%0a or \n) characters; comply with RFC2616 specs for HTTP/1.1; parse all user inputs or other forms of encoding before using them in HTTP headers</ul>
    <ul>Proxy Servers -> avoid sharing incoming TCP connections among different clients; use different TCP connections with the proxy for different virtual hosts; implement "maintain request host header" correctly</ul>
</ol></p>

<h2>Defend against DNS Hijacking</h2>
<p><ol>
    <ul>Choose a registrar accredited by the Internet Corporation for Assigned Names and Numbers (ICANN) and encourage the to set REGISTRAR-LOCK on the domain name</ul>
    <ul>Safeguard the registrant's account information</ul>
    <ul>Include DNS hijacking in incident response and business continuity planning</ul>
    <ul>Use DNS monitoring tools / services to monitor the IP address of the DNS server and set alerts</ul>
    <ul>Avoid downloading audio and video codecs and other downloaders from untrusted websites</ul>
    <ul>Install an antivirus program and update it regularly</ul>
    <ul>Change the default router password</ul>
    <ul>Restrict zone transfers and use script blockers in the browser</ul>
    <ul>Domain Name System Security Extensions (DNSSEC) adds an extra layer to DNS that prevents it from being hacked</ul>
    <ul>Strong password policies and user management: The use of strong passwords further enhances security.</ul>
<ul>Better service-level agreements (SLAs) from DNS service providers: When signing up for DNS servers with DNS service providers, learn who to contact when an issue occurs, how to receive good-quality reception and support, and whether the DNS server’s infrastructure is hardened against attacks.</ul>
<ul>Configuring a master–slave DNS within your network: Use a master–slave DNS and configure the master without Internet access. Maintain two slave servers so that even if an attacker hacks a slave, it will update only when it receives an update from the master.</ul>
<ul>Constant monitoring of DNS servers: The constant monitoring of DNS servers ensures that a domain name returns the correct IP address.</ul>
<ul>Ensure router safety: Change the default username and password of the router. Keep the firmware up-to-date for ensuring safety from new vulnerabilities.</ul>
<ul>Use VPN service: Establish virtual private network (VPN)-encrypted tunnels for secure private communication over the Internet. This feature protects messages from eavesdropping and unauthorized access.</ul>
<ul>Use firewall protection services to safeguard the original DNS resolvers and filter out the rogue DNS resolver traffic.</ul>
<ul>Maintain proper protection systems such as MFA and hardware security to ensure controlled access to the DNS server.</ul>
<ul>Install script blocker extensions in the browser</ul>
    <ul>Use only secured and reputed VPN networks instead of free VPN services, which can track your activities and record them for future use.</ul>
</ol></p>
